<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Cake Cutter</title>
    <style>
        :root {
            --safe-bottom: env(safe-area-inset-bottom, 20px);
            --safe-top: env(safe-area-inset-top, 20px);
        }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #000; color: white; height: 100dvh; width: 100vw; overflow: hidden; position: relative; }
        #video-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; display: flex; flex-direction: column; pointer-events: none; }
        #header { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); padding: 15px; padding-top: max(15px, var(--safe-top)); text-align: center; pointer-events: auto; display: flex; flex-direction: column; align-items: center; gap: 8px; }
        h2 { margin: 0; font-size: 18px; font-weight: 600; color: #fff; }
        #credit { font-size: 11px; color: #a0aec0; opacity: 0.9; }
        .settings-row { display: flex; gap: 12px; align-items: center; justify-content: center; width: 100%; }
        label { font-size: 14px; font-weight: 500; color: #cbd5e0; }
        input[type="number"] { width: 50px; padding: 8px; font-size: 16px; border-radius: 8px; border: 1px solid #4a5568; background: #2d3748; color: white; text-align: center; font-weight: bold; }
        #btn-start-camera { background: #48bb78; color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        #guide-container { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; width: 100%; }
        svg { width: 85vmin; height: 85vmin; max-width: 500px; max-height: 500px; pointer-events: none; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        #instructions-bubble { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.75); padding: 10px 16px; border-radius: 20px; font-size: 15px; font-weight: 600; text-align: center; width: 80%; max-width: 300px; border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(4px); pointer-events: auto; }
        #controls { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); padding: 10px 16px; padding-bottom: max(10px, var(--safe-bottom)); display: flex; gap: 10px; justify-content: space-between; align-items: center; pointer-events: auto; border-top: 1px solid rgba(255,255,255,0.1); }
        button { flex: 1; height: 50px; font-size: 16px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; transition: transform 0.1s, opacity 0.2s; display: flex; align-items: center; justify-content: center; }
        button:active { transform: scale(0.96); }
        button:disabled { opacity: 0.5; cursor: not-allowed; background: #4a5568 !important; color: #a0aec0 !important; }
        #btn-prev { background: #4a5568; color: white; max-width: 80px; }
        #btn-next { background: #3182ce; color: white; flex: 2; font-size: 18px; box-shadow: 0 4px 12px rgba(49, 130, 206, 0.4); }
        #btn-reset { background: transparent; border: 2px solid #718096; color: #cbd5e0; max-width: 80px; }
        .text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.9); }
    </style>
</head>
<body>
    <video id="video-bg" autoplay playsinline muted></video>
    <div id="ui-layer">
        <div id="header">
            <h2>üç∞ Cake Cutter AR</h2>
            <div id="credit">Designed by Dennis Chung</div>
            <div class="settings-row">
                <label for="slice-input">Slices:</label>
                <input type="number" id="slice-input" value="14" min="2" max="50" inputmode="numeric">
                <button id="btn-start-camera">üì∏ Start Camera</button>
            </div>
        </div>
        <div id="guide-container">
            <div id="instructions-bubble">Align circle & dot with cake</div>
            <svg id="cake-overlay" viewBox="0 0 300 300">
                <circle cx="150" cy="150" r="140" fill="none" stroke="rgba(255, 255, 255, 0.6)" stroke-width="2" stroke-dasharray="8 8"></circle>
                <circle cx="150" cy="150" r="6" fill="#48bb78" stroke="#fff" stroke-width="2"></circle>
                <text x="150" y="25" text-anchor="middle" fill="#fff" font-size="14" font-weight="bold" class="text-shadow">12</text>
                <text x="280" y="155" text-anchor="middle" fill="#fff" font-size="14" font-weight="bold" class="text-shadow">3</text>
                <text x="150" y="285" text-anchor="middle" fill="#fff" font-size="14" font-weight="bold" class="text-shadow">6</text>
                <text x="20" y="155" text-anchor="middle" fill="#fff" font-size="14" font-weight="bold" class="text-shadow">9</text>
                <g id="lines-group"></g>
            </svg>
        </div>
        <div id="controls">
            <button id="btn-prev" disabled>Back</button>
            <button id="btn-next">Next Cut</button>
            <button id="btn-reset">Reset</button>
        </div>
    </div>
    <script>
        const video = document.getElementById('video-bg');
        const btnStartCamera = document.getElementById('btn-start-camera');
        btnStartCamera.addEventListener('click', async () => {
            try {
                const constraints = { video: { facingMode: { ideal: 'environment' }, width: { ideal: 1280 }, height: { ideal: 720 } } };
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                btnStartCamera.style.display = 'none';
            } catch (err) { alert('Could not access camera. Please make sure you are on HTTPS and have granted permission. Error: ' + err.message); }
        });
        const linesGroup = document.getElementById('lines-group');
        const instructions = document.getElementById('instructions-bubble');
        const btnNext = document.getElementById('btn-next');
        const btnPrev = document.getElementById('btn-prev');
        const btnReset = document.getElementById('btn-reset');
        const sliceInput = document.getElementById('slice-input');
        let totalSteps = 7; let currentCut = 0; let cuts = []; let isEven = true;
        function generateLines() {
            linesGroup.innerHTML = ''; cuts = []; currentCut = 0;
            let slices = parseInt(sliceInput.value);
            if (isNaN(slices) || slices < 2) { slices = 14; sliceInput.value = 14; }
            isEven = (slices % 2 === 0); totalSteps = isEven ? (slices / 2) : slices;
            for(let i = 0; i < totalSteps; i++) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                if (isEven) {
                    const angle = (i * Math.PI) / totalSteps - Math.PI / 2;
                    line.setAttribute('x1', 150 + 140 * Math.cos(angle)); line.setAttribute('y1', 150 + 140 * Math.sin(angle));
                    line.setAttribute('x2', 150 - 140 * Math.cos(angle)); line.setAttribute('y2', 150 - 140 * Math.sin(angle));
                } else {
                    const angle = (i * 2 * Math.PI) / totalSteps - Math.PI / 2;
                    line.setAttribute('x1', 150); line.setAttribute('y1', 150);
                    line.setAttribute('x2', 150 + 140 * Math.cos(angle)); line.setAttribute('y2', 150 + 140 * Math.sin(angle));
                }
                line.setAttribute('stroke', 'rgba(255,255,255,0.3)'); line.setAttribute('stroke-width', '2'); line.setAttribute('stroke-dasharray', '6,6'); line.style.display = 'none';
                linesGroup.appendChild(line); cuts.push(line);
            }
            updateUI();
        }
        function updateUI() {
            cuts.forEach((line, index) => {
                line.style.display = index < currentCut ? 'block' : 'none';
                if (index === currentCut - 1) { line.setAttribute('stroke', '#48bb78'); line.setAttribute('stroke-width', '5'); line.setAttribute('stroke-dasharray', ''); line.setAttribute('stroke-linecap', 'round'); }
                else { line.setAttribute('stroke', 'rgba(255,255,255,0.6)'); line.setAttribute('stroke-width', '2'); line.setAttribute('stroke-dasharray', '5,5'); }
            });
            if (currentCut === 0) { instructions.innerText = 'Step 0: Align the circle & dot over your cake.'; btnPrev.disabled = true; btnNext.disabled = false; btnNext.innerText = 'Start Cutting'; }
            else if (currentCut > 0 && currentCut <= totalSteps) { const cutType = isEven ? 'across' : 'to center'; instructions.innerText = `Cut ${currentCut}/${totalSteps} (${cutType})`; btnPrev.disabled = false; btnNext.disabled = false; btnNext.innerText = 'Next Cut'; }
            else { instructions.innerText = `üéâ Done! ${sliceInput.value} equal slices.`; btnPrev.disabled = false; btnNext.disabled = true; btnNext.innerText = 'Finished'; }
        }
        sliceInput.addEventListener('change', generateLines);
        btnNext.addEventListener('click', (e) => { e.stopPropagation(); if (currentCut <= totalSteps) { currentCut++; updateUI(); } });
        btnPrev.addEventListener('click', (e) => { e.stopPropagation(); if (currentCut > 0) { currentCut--; updateUI(); } });
        btnReset.addEventListener('click', (e) => { e.stopPropagation(); currentCut = 0; updateUI(); });
        generateLines();
    </script>
</body>
</html>
